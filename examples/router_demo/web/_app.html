<!DOCTYPE html>
<html lang="zh-CN" data-theme="system">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JadeUI Demo</title>
    <link rel="icon" href="favicon.png">
    <!-- ç¬¬ä¸‰æ–¹åº“ -->

    <!-- å†…ç½®æ ·å¼ -->
    <link rel="stylesheet" href="css/jadeui.css">
    <!-- ç”¨æˆ·è‡ªå®šä¹‰æ ·å¼ (è‡ªåŠ¨æ£€æµ‹ css/app.css, css/style.css ç­‰) -->
    
    <style>:root { --sidebar-width: 200px; }</style>
</head>
<body>
    <div class="titlebar">
        <img src="favicon.png" class="titlebar-icon" alt=""><span class="titlebar-title">JadeUI Demo</span>
        <div class="titlebar-controls">
            <button class="titlebar-btn" onclick="windowAction('minimize')">â”€</button>
            <button class="titlebar-btn" onclick="windowAction('maximize')">â–¡</button>
            <button class="titlebar-btn close" onclick="windowAction('close')">âœ•</button>
        </div>
    </div>

    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h1>JadeUI Demo</h1>
            </div>
            <nav class="sidebar-nav">
                
                <div class="nav-item" data-path="/" onclick="router.go('/')">
                    <span class="nav-icon">ğŸ </span>
                    <span class="nav-text">é¦–é¡µ</span>
                </div>
                <div class="nav-item" data-path="/dashboard" onclick="router.go('/dashboard')">
                    <span class="nav-icon">ğŸ“Š</span>
                    <span class="nav-text">ä»ªè¡¨ç›˜</span>
                </div>
                <div class="nav-item" data-path="/users" onclick="router.go('/users')">
                    <span class="nav-icon">ğŸ‘¥</span>
                    <span class="nav-text">ç”¨æˆ·ç®¡ç†</span>
                </div>
                <div class="nav-item" data-path="/settings" onclick="router.go('/settings')">
                    <span class="nav-icon">âš™ï¸</span>
                    <span class="nav-text">è®¾ç½®</span>
                </div>
                <div class="nav-item" data-path="/about" onclick="router.go('/about')">
                    <span class="nav-icon">ğŸ˜„</span>
                    <span class="nav-text">å…³äº</span>
                </div>
            </nav>
            <div class="sidebar-footer">
                <div class="theme-switcher">
                    <button class="theme-btn" data-theme="light" onclick="setTheme('light')">æµ…è‰²</button>
                    <button class="theme-btn" data-theme="dark" onclick="setTheme('dark')">æ·±è‰²</button>
                    <button class="theme-btn active" data-theme="system" onclick="setTheme('system')">è‡ªåŠ¨</button>
                </div>
            </div>
        </div>

        <div class="main-content">
            <div class="content-header">
                <h2 id="page-title">åŠ è½½ä¸­...</h2>
            </div>
            <div class="content-body">
                <div id="page-content" class="page-container">
                    <div class="loading">æ­£åœ¨åŠ è½½...</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const routes = [{"path": "/", "template": "pages/home.html", "title": "\u9996\u9875"}, {"path": "/dashboard", "template": "pages/dashboard.html", "title": "\u4eea\u8868\u76d8"}, {"path": "/users", "template": "pages/users.html", "title": "\u7528\u6237\u7ba1\u7406"}, {"path": "/user/:id", "template": "pages/user.html", "title": "\u7528\u6237\u8be6\u60c5"}, {"path": "/settings", "template": "pages/settings.html", "title": "\u8bbe\u7f6e"}, {"path": "/about", "template": "pages/about.html", "title": "\u5173\u4e8e"}];
        let currentPath = '';

        const router = {
            go: function(path) { jade.invoke('router:navigate', path); },
            current: function() { return currentPath; },
            params: {},
        };

        function windowAction(action) { jade.invoke('windowAction', action); }

        function setTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === theme);
            });
            jade.invoke('router:setTheme', theme);
        }

        function setBackdrop(backdrop) {
            jade.invoke('router:setBackdrop', backdrop);
        }

        function updateNavHighlight(path) {
            document.querySelectorAll('.nav-item').forEach(item => {
                const itemPath = item.dataset.path;
                const isActive = itemPath === path ||
                    (path.startsWith(itemPath + '/') && itemPath !== '/') ||
                    (itemPath === '/' && path === '/');
                item.classList.toggle('active', isActive);
            });
        }

        async function loadTemplate(template, params) {
            try {
                const response = await fetch(template + '?t=' + Date.now());
                if (!response.ok) throw new Error('Template not found');
                let html = await response.text();
                for (const [key, value] of Object.entries(params)) {
                    html = html.replace(new RegExp('\\{\\{' + key + '\\}\\}', 'g'), value);
                }
                return html;
            } catch (e) {
                console.error('åŠ è½½æ¨¡æ¿å¤±è´¥:', e);
                return '<div class="card"><p>é¡µé¢åŠ è½½å¤±è´¥</p></div>';
            }
        }

        jade.ipcMain('router:update', async function(data) {
            try {
                const navData = JSON.parse(data);
                currentPath = navData.path;
                router.params = navData.params || {};

                document.getElementById('page-title').textContent = navData.title;
                document.title = navData.title + ' - JadeUI Demo';
                updateNavHighlight(navData.path);

                const content = await loadTemplate(navData.template, navData.params);
                const container = document.getElementById('page-content');
                container.innerHTML = content;

                // é‡æ–°è§¦å‘åŠ¨ç”»
                container.classList.remove('page-container');
                void container.offsetWidth;
                container.classList.add('page-container');

                // æ‰§è¡Œé¡µé¢è„šæœ¬
                container.querySelectorAll('script').forEach(script => {
                    const newScript = document.createElement('script');
                    newScript.textContent = script.textContent;
                    script.parentNode.replaceChild(newScript, script);
                });
            } catch (e) {
                console.error('å¯¼èˆªå¤±è´¥:', e);
            }
        });

        jade.ipcMain('router:themeChanged', function(theme) {
            document.documentElement.setAttribute('data-theme', theme.toLowerCase());
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === theme.toLowerCase());
            });
        });

        // é€šçŸ¥åç«¯å‰ç«¯å·²å‡†å¤‡å¥½
        jade.invoke('router:ready', '');
    </script>
    <!-- ç¬¬ä¸‰æ–¹è„šæœ¬ -->

    <!-- ç”¨æˆ·è‡ªå®šä¹‰è„šæœ¬ (è‡ªåŠ¨æ£€æµ‹ js/app.js, js/main.js ç­‰) -->
    
</body>
</html>