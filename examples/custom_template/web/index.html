<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Custom Template</title>
    <!-- å›¾æ ‡ -->
    <link rel="icon" href="favicon.png">
    <!-- å¯ä»¥ä½¿ç”¨å†…ç½®æ ·å¼ä½œä¸ºåŸºç¡€ -->
    <link rel="stylesheet" href="css/jadeui.css">
    <!-- ä½ çš„è‡ªå®šä¹‰æ ·å¼ -->
    <link rel="stylesheet" href="css/custom.css">
</head>
<body>
    <!-- å®Œå…¨è‡ªå®šä¹‰çš„å¸ƒå±€ï¼šé¡¶éƒ¨å¯¼èˆªæ  -->
    <header class="header">
        <div class="logo">ğŸŒ¿ My App</div>
        <nav class="nav">
            <a href="#" onclick="router.go('/'); return false;">é¦–é¡µ</a>
            <a href="#" onclick="router.go('/products'); return false;">äº§å“</a>
            <a href="#" onclick="router.go('/contact'); return false;">è”ç³»æˆ‘ä»¬</a>
        </nav>
        <div class="header-controls">
            <button id="theme-btn" onclick="toggleTheme()">ğŸŒ™</button>
            <button onclick="windowAction('minimize')">â”€</button>
            <button onclick="windowAction('maximize')">â–¡</button>
            <button onclick="windowAction('close')" class="close">âœ•</button>
        </div>
    </header>

    <!-- é¡µé¢å†…å®¹åŒºåŸŸ -->
    <main class="main">
        <div id="page-content">
            <p style="text-align: center; padding: 40px; color: var(--text-muted);">åŠ è½½ä¸­...</p>
        </div>
    </main>

    <!-- åº•éƒ¨ -->
    <footer class="footer">
        <span id="page-title">é¦–é¡µ</span>
        <span>Â© 2024 My App</span>
    </footer>

    <script>
        // ========== è·¯ç”±å™¨ ==========
        const router = {
            go: function(path) {
                jade.invoke('router:navigate', path);
            },
            params: {},
        };

        // ========== çª—å£æ§åˆ¶ ==========
        function windowAction(action) {
            jade.invoke('windowAction', action);
        }

        // ========== ä¸»é¢˜åˆ‡æ¢ ==========
        function toggleTheme() {
            const html = document.documentElement;
            const current = html.getAttribute('data-theme');
            const next = current === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', next);
            updateThemeIcon(next);
            jade.invoke('router:setTheme', next);
        }

        function updateThemeIcon(theme) {
            const btn = document.getElementById('theme-btn');
            btn.textContent = theme === 'dark' ? 'ğŸŒ™' : 'â˜€ï¸';
        }

        // ========== æ›´æ–°å¯¼èˆªé«˜äº® ==========
        function updateNav(path) {
            document.querySelectorAll('.nav a').forEach(a => {
                a.classList.remove('active');
            });
            const activeLink = document.querySelector(`.nav a[onclick*="'${path}'"]`);
            if (activeLink) activeLink.classList.add('active');
        }

        // ========== ç›‘å¬è·¯ç”±æ›´æ–° ==========
        jade.ipcMain('router:update', async function(data) {
            try {
                const navData = JSON.parse(data);
                router.params = navData.params || {};

                // æ›´æ–°æ ‡é¢˜
                document.getElementById('page-title').textContent = navData.title;
                document.title = navData.title;

                // æ›´æ–°å¯¼èˆªé«˜äº®
                updateNav(navData.path);

                // åŠ è½½é¡µé¢å†…å®¹
                const response = await fetch(navData.template + '?t=' + Date.now());
                const html = await response.text();
                
                const container = document.getElementById('page-content');
                container.innerHTML = html;

                // æ‰§è¡Œé¡µé¢è„šæœ¬
                container.querySelectorAll('script').forEach(script => {
                    const newScript = document.createElement('script');
                    newScript.textContent = script.textContent;
                    script.parentNode.replaceChild(newScript, script);
                });

            } catch (e) {
                console.error('å¯¼èˆªå¤±è´¥:', e);
            }
        });

        // ========== ç›‘å¬ä¸»é¢˜å˜åŒ– ==========
        jade.ipcMain('router:themeChanged', function(theme) {
            document.documentElement.setAttribute('data-theme', theme.toLowerCase());
            updateThemeIcon(theme.toLowerCase());
        });

        // ========== é€šçŸ¥åç«¯å‡†å¤‡å¥½äº† ==========
        jade.invoke('router:ready', '');
    </script>
</body>
</html>

